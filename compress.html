
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compress PDF online. Same PDF quality less file size</title>
    <meta name="description" content="Compress PDF file to get the same PDF quality but less filesize. Compress or optimize PDF files online, easily and free." />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-32x32.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Babel for JSX execution in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            red: '#E5322D',
                            redHover: '#D12D28',
                            dark: '#33333B',
                            light: '#F5F5FA',
                            gray: '#161616'
                        }
                    },
                    animation: {
                        'progress': 'progress 2s ease-in-out infinite',
                    },
                    keyframes: {
                        progress: {
                            '0%': { width: '0%', left: '0%' },
                            '50%': { width: '50%', left: '25%' },
                            '100%': { width: '100%', left: '100%' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body { background-color: #f5f5fa; }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #999; }
    </style>

    <!-- Import Map for Modules -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.344.0?deps=react@18.2.0",
    "pdf-lib": "https://esm.sh/pdf-lib@1.17.1",
    "jszip": "https://esm.sh/jszip@3.10.1",
    "pdfjs-dist": "https://esm.sh/pdfjs-dist@3.11.174",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react-router-dom": "https://aistudiocdn.com/react-router-dom@^7.9.6"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useCallback, useRef, useEffect } from 'react';
        import ReactDOM from 'react-dom/client';
        import { 
            Upload, Trash2, ArrowLeft, ArrowRight, Plus, FileText, 
            Download, Loader2, Menu, X, Settings, CheckCircle2, Info
        } from 'lucide-react';
        import { PDFDocument } from 'pdf-lib';
        import JSZip from 'jszip';
        import * as pdfjsProxy from 'pdfjs-dist';

        // --- PDF.js WORKER SETUP ---
        const pdfjsLib = pdfjsProxy.default || pdfjsProxy;
        if (pdfjsLib && pdfjsLib.GlobalWorkerOptions) {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://esm.sh/pdfjs-dist@3.11.174/build/pdf.worker.min.js';
        }

        // --- CONSTANTS ---
        const TOOLS = [
            { name: 'Merge PDF', href: '#' },
            { name: 'Split PDF', href: '#' },
            { name: 'Compress PDF', href: '#', active: true },
            { name: 'Convert PDF', href: '#' },
            { name: 'All PDF Tools', href: '#' },
        ];

        const COMPRESSION_LEVELS = {
            EXTREME: {
                id: 'extreme',
                title: 'Extreme Compression',
                description: 'Less quality, high compression',
                factor: 0.25 // Simulated 75% reduction
            },
            RECOMMENDED: {
                id: 'recommended',
                title: 'Recommended Compression',
                description: 'Good quality, good compression',
                factor: 0.60 // Simulated 40% reduction
            },
            LOW: {
                id: 'low',
                title: 'Less compression',
                description: 'High quality, less compression',
                factor: 0.90 // Simulated 10% reduction
            }
        };

        // --- UTILS ---
        const formatBytes = (bytes, decimals = 2) => {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        };

        // --- UI COMPONENTS ---

        const Header = () => {
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            return (
                <header className="bg-white shadow-sm sticky top-0 z-50 h-[60px] flex items-center">
                    <div className="container mx-auto px-4 flex justify-between items-center h-full">
                        <div className="flex items-center">
                            <a href="#" className="flex items-center gap-2 text-brand-dark no-underline group">
                                <div className="flex flex-col leading-none">
                                    <span className="font-extrabold text-2xl tracking-tighter flex">
                                        <span className="text-brand-dark">Snap</span>
                                        <span className="text-brand-red">PDF</span>
                                    </span>
                                </div>
                            </a>
                        </div>
                        <nav className="hidden md:flex items-center gap-8 text-sm font-medium text-gray-600 uppercase">
                            {TOOLS.map(tool => (
                                <a 
                                    key={tool.name} 
                                    href={tool.href} 
                                    className={`transition-colors ${tool.active ? 'text-brand-red hover:text-brand-redHover' : 'hover:text-brand-gray'}`}
                                >
                                    {tool.name}
                                </a>
                            ))}
                        </nav>
                        <button className="md:hidden text-gray-600" onClick={() => setIsMenuOpen(!isMenuOpen)}>
                            {isMenuOpen ? <X size={24} /> : <Menu size={24} />}
                        </button>
                    </div>
                    {isMenuOpen && (
                        <div className="absolute top-[60px] left-0 w-full bg-white border-t border-gray-100 shadow-lg p-4 flex flex-col gap-4 md:hidden z-50">
                            {TOOLS.map(tool => (
                                <a key={tool.name} href={tool.href} className={tool.active ? 'text-brand-red font-semibold' : 'text-gray-600'}>{tool.name}</a>
                            ))}
                        </div>
                    )}
                </header>
            );
        };

        const Footer = () => (
            <footer className="bg-white border-t border-gray-200 py-8 mt-auto">
                <div className="container mx-auto px-4 text-center">
                    <div className="flex flex-wrap justify-center gap-6 mb-6 text-gray-600 text-sm font-medium">
                        <a href="#" className="hover:text-brand-red">Home</a>
                        <a href="#" className="hover:text-brand-red">Features</a>
                        <a href="#" className="hover:text-brand-red">Pricing</a>
                        <a href="#" className="hover:text-brand-red">Tools</a>
                        <a href="#" className="hover:text-brand-red">FAQ</a>
                    </div>
                    <p className="text-gray-400 text-xs">© iLovePDF 2025 ® - Your PDF Editor</p>
                </div>
            </footer>
        );

        // Thumbnail Component using PDF.js
        const PDFThumb = ({ fileUrl, pageNum = 1 }) => {
            const canvasRef = useRef(null);
            const [loading, setLoading] = useState(true);
            
            useEffect(() => {
                let isMounted = true;
                let pdfDoc = null;

                const renderPage = async () => {
                    if (!fileUrl) return;
                    try {
                        const loadingTask = pdfjsLib.getDocument(fileUrl);
                        pdfDoc = await loadingTask.promise;
                        if(!isMounted) return;
                        
                        const page = await pdfDoc.getPage(pageNum);
                        // Fixed height thumbnail
                        const viewport = page.getViewport({ scale: 1 });
                        const scale = 200 / viewport.height;
                        const scaledViewport = page.getViewport({ scale });
                        
                        const canvas = canvasRef.current;
                        if (canvas) {
                            const context = canvas.getContext('2d');
                            canvas.height = scaledViewport.height;
                            canvas.width = scaledViewport.width;
                            
                            await page.render({
                                canvasContext: context,
                                viewport: scaledViewport
                            }).promise;
                        }
                        if(isMounted) setLoading(false);
                    } catch (err) {
                        console.error("Thumbnail error:", err);
                        if(isMounted) setLoading(false);
                    }
                };
                renderPage();
                return () => { isMounted = false; if(pdfDoc) pdfDoc.destroy(); };
            }, [fileUrl, pageNum]);

            return (
                <div className="relative w-full h-full flex items-center justify-center bg-white overflow-hidden">
                    {loading ? (
                        <div className="animate-spin text-gray-300"><Loader2 size={20} /></div>
                    ) : (
                        <canvas ref={canvasRef} className="object-contain shadow-sm border border-gray-100" />
                    )}
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---
        const CompressTool = () => {
            // State
            const [files, setFiles] = useState([]); // Array of { id, file, url }
            const [status, setStatus] = useState('IDLE'); // IDLE, SELECTED, UPLOADING, COMPRESSING, COMPLETED
            const [compressionLevel, setCompressionLevel] = useState('recommended');
            const [progress, setProgress] = useState(0);
            const [resultStats, setResultStats] = useState(null);
            
            const fileInputRef = useRef(null);

            // Cleanup object URLs
            useEffect(() => {
                return () => {
                    files.forEach(f => URL.revokeObjectURL(f.url));
                };
            }, [files]);

            const handleFileSelect = async (e) => {
                const newFiles = [];
                if (e.target.files && e.target.files.length > 0) {
                    for (let i = 0; i < e.target.files.length; i++) {
                        const file = e.target.files[i];
                        if (file.type === 'application/pdf') {
                            newFiles.push({
                                id: Math.random().toString(36).substr(2, 9),
                                file: file,
                                url: URL.createObjectURL(file)
                            });
                        }
                    }
                }
                if (newFiles.length > 0) {
                    setFiles(prev => [...prev, ...newFiles]);
                    setStatus('SELECTED');
                }
            };

            const removeFile = (id) => {
                const newFiles = files.filter(f => f.id !== id);
                setFiles(newFiles);
                if (newFiles.length === 0) {
                    setStatus('IDLE');
                }
            };

            const resetTool = () => {
                setFiles([]);
                setStatus('IDLE');
                setProgress(0);
                setResultStats(null);
            };

            const handleCompress = async () => {
                setStatus('UPLOADING');
                
                // Simulate Upload Progress
                let p = 0;
                const interval = setInterval(() => {
                    p += 5;
                    if (p >= 100) {
                        clearInterval(interval);
                        startCompression();
                    } else {
                        setProgress(p);
                    }
                }, 50);
            };

            const startCompression = async () => {
                setStatus('COMPRESSING');
                
                // Simulate Server Processing time
                setTimeout(async () => {
                    try {
                        const zip = new JSZip();
                        let totalOriginalSize = 0;
                        
                        // Process each file (Simulated)
                        for (const f of files) {
                            totalOriginalSize += f.file.size;
                            const arrayBuffer = await f.file.arrayBuffer();
                            // We are not actually compressing because JS libraries for this are heavy/complex
                            // But we save the file. In a real app, this would fetch from server.
                            const pdfDoc = await PDFDocument.load(arrayBuffer);
                            const pdfBytes = await pdfDoc.save();
                            
                            const name = f.file.name.replace('.pdf', '_compressed.pdf');
                            zip.file(name, pdfBytes);
                        }

                        let downloadContent;
                        let downloadName;

                        if (files.length === 1) {
                            // Single file download
                            const content = await zip.file(new RegExp(files[0].file.name.replace('.pdf', '_compressed.pdf')))[0].async('blob');
                            downloadContent = URL.createObjectURL(content);
                            downloadName = files[0].file.name.replace('.pdf', '_compressed.pdf');
                        } else {
                            // Zip download
                            const content = await zip.generateAsync({ type: "blob" });
                            downloadContent = URL.createObjectURL(content);
                            downloadName = "ilovepdf_compressed.zip";
                        }

                        // Calculate fake stats based on level
                        const factor = COMPRESSION_LEVELS[compressionLevel.toUpperCase()].factor;
                        const compressedSize = totalOriginalSize * factor;
                        const saved = totalOriginalSize - compressedSize;
                        const percentage = Math.round((saved / totalOriginalSize) * 100);

                        setResultStats({
                            url: downloadContent,
                            name: downloadName,
                            originalSize: totalOriginalSize,
                            compressedSize: compressedSize,
                            percentage: percentage
                        });

                        setStatus('COMPLETED');

                    } catch (e) {
                        console.error(e);
                        alert("An error occurred during processing.");
                        setStatus('SELECTED');
                    }
                }, 2000);
            };

            // --- VIEWS ---

            // 1. IDLE (Landing)
            if (status === 'IDLE') {
                return (
                    <div 
                        className="flex flex-col items-center justify-center min-h-[calc(100vh-140px)] p-6 animate-in fade-in"
                        onDragOver={(e) => e.preventDefault()}
                        onDrop={(e) => {
                            e.preventDefault();
                            if (e.dataTransfer.files) handleFileSelect({ target: { files: e.dataTransfer.files } });
                        }}
                    >
                        <h1 className="text-3xl md:text-5xl font-bold text-brand-dark mb-4 text-center leading-tight">
                            Compress PDF file
                        </h1>
                        <h2 className="text-lg md:text-xl text-gray-500 mb-10 text-center max-w-2xl font-light">
                            Reduce file size while optimizing for maximal PDF quality.
                        </h2>
                        <div className="relative group">
                            <button 
                                onClick={() => fileInputRef.current?.click()}
                                className="bg-brand-red hover:bg-brand-redHover text-white text-xl md:text-2xl font-bold py-6 px-12 md:px-16 rounded-lg shadow-xl transition-all transform hover:-translate-y-0.5 flex items-center gap-4"
                            >
                                Select PDF files
                            </button>
                            <p className="text-gray-400 text-sm mt-4 text-center">or drop PDFs here</p>
                        </div>
                        <div className="mt-8 flex gap-4">
                            <button className="p-3 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow" title="Google Drive">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/1/12/Google_Drive_icon_%282020%29.svg" alt="Drive" className="w-6 h-6" />
                            </button>
                            <button className="p-3 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow" title="Dropbox">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/7/78/Dropbox_Icon.svg" alt="Dropbox" className="w-6 h-6" />
                            </button>
                        </div>
                        <input 
                            type="file" 
                            ref={fileInputRef}
                            onChange={handleFileSelect}
                            className="hidden"
                            accept=".pdf"
                            multiple
                        />
                    </div>
                );
            }

            // 3. UPLOADING / COMPRESSING
            if (status === 'UPLOADING' || status === 'COMPRESSING') {
                return (
                    <div className="flex flex-col items-center justify-center min-h-[calc(100vh-140px)] p-6 text-center">
                        <h2 className="text-2xl font-bold text-gray-700 mb-8">
                            {status === 'UPLOADING' ? 'Uploading files...' : 'Compressing PDF...'}
                        </h2>
                        
                        <div className="w-full max-w-md h-4 bg-gray-200 rounded-full overflow-hidden relative">
                            {status === 'UPLOADING' ? (
                                <div 
                                    className="h-full bg-brand-red transition-all duration-300 ease-out"
                                    style={{ width: `${progress}%` }}
                                ></div>
                            ) : (
                                <div className="absolute top-0 left-0 h-full bg-brand-red w-1/3 animate-[progress_1.5s_ease-in-out_infinite]"></div>
                            )}
                        </div>
                        
                        <p className="mt-4 text-gray-500 text-sm font-medium">
                            {status === 'UPLOADING' 
                                ? `Uploading ${Math.round(progress)}%` 
                                : 'We are making your PDF smaller...'}
                        </p>

                        {status === 'COMPRESSING' && (
                             <div className="mt-4 text-xs text-gray-400">Do not close your browser</div>
                        )}
                    </div>
                );
            }

            // 4. COMPLETED
            if (status === 'COMPLETED' && resultStats) {
                return (
                    <div className="flex flex-col items-center justify-center min-h-[calc(100vh-140px)] p-6 text-center bg-gray-50">
                        <div className="bg-white p-8 md:p-12 rounded-xl shadow-lg max-w-3xl w-full border border-gray-100">
                            <div className="flex justify-center mb-6">
                                <div className="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center">
                                    <Download className="text-brand-red w-10 h-10" />
                                </div>
                            </div>
                            
                            <h1 className="text-3xl font-bold text-gray-800 mb-4">
                                PDFs have been compressed!
                            </h1>
                            
                            <div className="text-gray-600 mb-8 text-lg">
                                We compressed your PDF by <span className="font-bold text-green-600">{resultStats.percentage}%</span>. <br/>
                                <span className="text-gray-400 text-base mt-2 block">
                                    From <span className="line-through decoration-gray-400">{formatBytes(resultStats.originalSize)}</span> to <span className="font-bold text-gray-800">{formatBytes(resultStats.compressedSize)}</span>
                                </span>
                            </div>

                            <div className="flex flex-col gap-4 items-center justify-center">
                                <a 
                                    href={resultStats.url} 
                                    download={resultStats.name}
                                    className="w-full md:w-auto bg-brand-red hover:bg-brand-redHover text-white font-bold text-xl py-4 px-12 rounded-lg shadow-lg transition-colors flex items-center justify-center gap-3 transform active:scale-95"
                                >
                                    <Download size={24} />
                                    Download compressed PDF
                                </a>
                                
                                <div className="flex gap-4 mt-6">
                                    <button className="p-2 text-gray-400 hover:text-brand-red transition-colors" title="Delete">
                                        <Trash2 size={20} />
                                    </button>
                                    <button className="text-brand-red font-medium hover:underline" onClick={resetTool}>
                                        Compress another PDF
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // 2. SELECTED (Workspace)
            return (
                <div className="flex flex-col md:flex-row tool-workspace relative h-[calc(100vh-60px)]">
                    {/* Main Area */}
                    <div className="flex-1 bg-brand-light relative flex flex-col">
                        <div className="p-4 flex justify-between items-center md:hidden">
                            <button onClick={resetTool} className="text-gray-500"><ArrowLeft /></button>
                            <span className="font-semibold text-gray-700">Compress PDF</span>
                            <div className="w-6"></div>
                        </div>

                        <div className="flex-1 overflow-y-auto p-4 md:p-8 custom-scrollbar">
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 max-w-6xl mx-auto pb-24">
                                {files.map((file) => (
                                    <div key={file.id} className="relative group bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-all duration-200 flex flex-col h-64 overflow-hidden">
                                        <div className="flex-1 p-4 flex items-center justify-center bg-gray-50">
                                            <div className="w-32 shadow-md bg-white h-40 relative">
                                                <PDFThumb fileUrl={file.url} />
                                            </div>
                                        </div>
                                        <div className="h-14 px-4 flex flex-col justify-center border-t border-gray-100 bg-white">
                                            <span className="text-sm font-medium text-gray-700 truncate block w-full" title={file.file.name}>
                                                {file.file.name}
                                            </span>
                                            <span className="text-xs text-gray-400">
                                                {formatBytes(file.file.size)}
                                            </span>
                                        </div>
                                        <button 
                                            onClick={() => removeFile(file.id)}
                                            className="absolute top-2 right-2 bg-red-500 hover:bg-red-600 text-white p-1.5 rounded-full opacity-0 group-hover:opacity-100 transition-all shadow-sm z-10"
                                        >
                                            <X size={14} />
                                        </button>
                                    </div>
                                ))}
                                
                                <div 
                                    onClick={() => fileInputRef.current?.click()}
                                    className="border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center h-64 cursor-pointer hover:bg-gray-50 hover:border-brand-red transition-colors group"
                                >
                                    <div className="w-12 h-12 bg-brand-red rounded-full flex items-center justify-center text-white shadow-md mb-3 group-hover:scale-110 transition-transform">
                                        <Plus size={24} />
                                    </div>
                                    <span className="text-sm font-medium text-gray-500 group-hover:text-brand-red">Add more files</span>
                                </div>
                            </div>
                        </div>

                        <input 
                            type="file" 
                            ref={fileInputRef}
                            onChange={handleFileSelect}
                            className="hidden"
                            accept=".pdf"
                            multiple
                        />
                    </div>

                    {/* Sidebar Controls */}
                    <div className="w-full md:w-[320px] bg-white border-l border-gray-200 flex flex-col shadow-xl z-20 absolute md:relative bottom-0 h-auto md:h-full">
                        <div className="p-5 border-b border-gray-200 hidden md:block">
                            <h2 className="text-lg font-bold text-gray-800 text-center">Compression level</h2>
                        </div>

                        <div className="flex-1 overflow-y-auto p-4 space-y-3 bg-white">
                            {Object.values(COMPRESSION_LEVELS).map((level) => (
                                <div
                                    key={level.id}
                                    onClick={() => setCompressionLevel(level.id)}
                                    className={`relative p-4 border rounded-lg cursor-pointer transition-all duration-200 group ${
                                        compressionLevel === level.id
                                            ? 'border-brand-red bg-red-50/50 shadow-sm'
                                            : 'border-gray-200 hover:border-gray-300 hover:bg-gray-50'
                                    }`}
                                >
                                    <div className="flex items-start gap-3">
                                        <div className="flex-1">
                                            <h3 className={`font-bold text-sm mb-1 ${compressionLevel === level.id ? 'text-brand-red' : 'text-gray-700'}`}>
                                                {level.title}
                                            </h3>
                                            <p className="text-xs text-gray-500 leading-relaxed">{level.description}</p>
                                        </div>
                                        {compressionLevel === level.id && (
                                            <CheckCircle2 size={18} className="text-brand-red flex-shrink-0 mt-0.5" />
                                        )}
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Action Button */}
                        <div className="p-4 border-t border-gray-200 bg-gray-50">
                            <button 
                                onClick={handleCompress}
                                className="w-full bg-brand-red hover:bg-brand-redHover text-white text-xl font-bold py-4 rounded-lg shadow-lg transition-all flex items-center justify-center gap-2 transform active:scale-[0.98]"
                            >
                                Compress PDF <span className="hidden md:inline">→</span>
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            return (
                <div className="flex flex-col min-h-screen font-sans text-brand-gray">
                    <Header />
                    <main className="flex-1 flex flex-col">
                        <CompressTool />
                    </main>
                    <Footer />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(
            <React.StrictMode>
                <App />
            </React.StrictMode>
        );
    </script>
</body>
</html>
